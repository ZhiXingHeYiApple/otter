package com.alibaba.otter.node.etl.load;

import com.alibaba.fastjson.JSON;
import com.alibaba.fastjson.JSONArray;
import com.alibaba.otter.node.etl.load.loader.db.DbLoadMerger;
import com.alibaba.otter.shared.etl.model.EventData;

import java.util.List;

/**
 * @author Depu Lai
 * @description
 * @company BestSign
 * @date 2018/6/9
 * @since
 */
public class LoadMergeTest {
    public static void main(String[] args){
        String itemsJson = "[{\"columns\":[{\"columnName\":\"mgr\",\"columnType\":-5,\"columnValue\":\"1\",\"index\":4,\"key\":false,\"null\":false,\"update\":true}],\"eventType\":\"UPDATE\",\"executeTime\":1528522525000,\"keys\":[{\"columnName\":\"id\",\"columnType\":-5,\"columnValue\":\"3\",\"index\":0,\"key\":true,\"null\":false,\"update\":false}],\"oldKeys\":[],\"pairId\":1,\"remedy\":false,\"schemaName\":\"bestsign_test\",\"size\":144,\"tableId\":3,\"tableName\":\"employee\",\"updatedColumns\":[{\"$ref\":\"$[0].columns[0]\"}],\"updatedKeys\":[],\"withoutSchema\":false},{\"columns\":[{\"columnName\":\"mgr\",\"columnType\":-5,\"columnValue\":\"2\",\"index\":4,\"key\":false,\"null\":false,\"update\":true}],\"eventType\":\"UPDATE\",\"executeTime\":1528522525000,\"keys\":[{\"columnName\":\"id\",\"columnType\":-5,\"columnValue\":\"3\",\"index\":0,\"key\":true,\"null\":false,\"update\":false}],\"oldKeys\":[],\"pairId\":1,\"remedy\":false,\"schemaName\":\"bestsign_test\",\"size\":144,\"tableId\":3,\"tableName\":\"employee\",\"updatedColumns\":[{\"$ref\":\"$[1].columns[0]\"}],\"updatedKeys\":[],\"withoutSchema\":false},{\"columns\":[{\"columnName\":\"mgr\",\"columnType\":-5,\"columnValue\":\"1\",\"index\":4,\"key\":false,\"null\":false,\"update\":true}],\"eventType\":\"UPDATE\",\"executeTime\":1528522525000,\"keys\":[{\"columnName\":\"id\",\"columnType\":-5,\"columnValue\":\"4\",\"index\":0,\"key\":true,\"null\":false,\"update\":false}],\"oldKeys\":[],\"pairId\":1,\"remedy\":false,\"schemaName\":\"bestsign_test\",\"size\":144,\"tableId\":3,\"tableName\":\"employee\",\"updatedColumns\":[{\"$ref\":\"$[2].columns[0]\"}],\"updatedKeys\":[],\"withoutSchema\":false},{\"columns\":[{\"columnName\":\"mgr\",\"columnType\":-5,\"columnValue\":\"2\",\"index\":4,\"key\":false,\"null\":false,\"update\":true}],\"eventType\":\"UPDATE\",\"executeTime\":1528522525000,\"keys\":[{\"columnName\":\"id\",\"columnType\":-5,\"columnValue\":\"4\",\"index\":0,\"key\":true,\"null\":false,\"update\":false}],\"oldKeys\":[],\"pairId\":1,\"remedy\":false,\"schemaName\":\"bestsign_test\",\"size\":144,\"tableId\":3,\"tableName\":\"employee\",\"updatedColumns\":[{\"$ref\":\"$[3].columns[0]\"}],\"updatedKeys\":[],\"withoutSchema\":false},{\"columns\":[{\"columnName\":\"empno\",\"columnType\":-5,\"columnValue\":\"6\",\"index\":1,\"key\":false,\"null\":false,\"update\":true},{\"columnName\":\"ename\",\"columnType\":12,\"columnValue\":\"michale\",\"index\":2,\"key\":false,\"null\":false,\"update\":true},{\"columnName\":\"job\",\"columnType\":12,\"columnValue\":\"salesman\",\"index\":3,\"key\":false,\"null\":false,\"update\":true},{\"columnName\":\"mgr\",\"columnType\":-5,\"columnValue\":\"0\",\"index\":4,\"key\":false,\"null\":false,\"update\":true},{\"columnName\":\"hiredate\",\"columnType\":91,\"columnValue\":\"2018-06-09\",\"index\":5,\"key\":false,\"null\":false,\"update\":true},{\"columnName\":\"sal\",\"columnType\":3,\"columnValue\":\"2000.0\",\"index\":6,\"key\":false,\"null\":false,\"update\":true},{\"columnName\":\"comm\",\"columnType\":3,\"columnValue\":\"400.0\",\"index\":7,\"key\":false,\"null\":false,\"update\":true},{\"columnName\":\"deptno\",\"columnType\":-5,\"columnValue\":\"2\",\"index\":8,\"key\":false,\"null\":false,\"update\":true}],\"eventType\":\"INSERT\",\"executeTime\":1528522525000,\"keys\":[{\"columnName\":\"id\",\"columnType\":-5,\"columnValue\":\"6\",\"index\":0,\"key\":true,\"null\":false,\"update\":true}],\"oldKeys\":[],\"pairId\":1,\"remedy\":false,\"schemaName\":\"bestsign_test\",\"size\":89,\"tableId\":3,\"tableName\":\"employee\",\"updatedColumns\":[{\"$ref\":\"$[4].columns[0]\"},{\"$ref\":\"$[4].columns[1]\"},{\"$ref\":\"$[4].columns[2]\"},{\"$ref\":\"$[4].columns[3]\"},{\"$ref\":\"$[4].columns[4]\"},{\"$ref\":\"$[4].columns[5]\"},{\"$ref\":\"$[4].columns[6]\"},{\"$ref\":\"$[4].columns[7]\"}],\"updatedKeys\":[{\"$ref\":\"$[4].keys[0]\"}],\"withoutSchema\":false},{\"columns\":[{\"columnName\":\"empno\",\"columnType\":-5,\"columnValue\":\"7\",\"index\":1,\"key\":false,\"null\":false,\"update\":true},{\"columnName\":\"ename\",\"columnType\":12,\"columnValue\":\"michale\",\"index\":2,\"key\":false,\"null\":false,\"update\":true},{\"columnName\":\"job\",\"columnType\":12,\"columnValue\":\"salesman\",\"index\":3,\"key\":false,\"null\":false,\"update\":true},{\"columnName\":\"mgr\",\"columnType\":-5,\"columnValue\":\"0\",\"index\":4,\"key\":false,\"null\":false,\"update\":true},{\"columnName\":\"hiredate\",\"columnType\":91,\"columnValue\":\"2018-06-09\",\"index\":5,\"key\":false,\"null\":false,\"update\":true},{\"columnName\":\"sal\",\"columnType\":3,\"columnValue\":\"2000.0\",\"index\":6,\"key\":false,\"null\":false,\"update\":true},{\"columnName\":\"comm\",\"columnType\":3,\"columnValue\":\"400.0\",\"index\":7,\"key\":false,\"null\":false,\"update\":true},{\"columnName\":\"deptno\",\"columnType\":-5,\"columnValue\":\"2\",\"index\":8,\"key\":false,\"null\":false,\"update\":true}],\"eventType\":\"INSERT\",\"executeTime\":1528522525000,\"keys\":[{\"columnName\":\"id\",\"columnType\":-5,\"columnValue\":\"7\",\"index\":0,\"key\":true,\"null\":false,\"update\":true}],\"oldKeys\":[],\"pairId\":1,\"remedy\":false,\"schemaName\":\"bestsign_test\",\"size\":89,\"tableId\":3,\"tableName\":\"employee\",\"updatedColumns\":[{\"$ref\":\"$[5].columns[0]\"},{\"$ref\":\"$[5].columns[1]\"},{\"$ref\":\"$[5].columns[2]\"},{\"$ref\":\"$[5].columns[3]\"},{\"$ref\":\"$[5].columns[4]\"},{\"$ref\":\"$[5].columns[5]\"},{\"$ref\":\"$[5].columns[6]\"},{\"$ref\":\"$[5].columns[7]\"}],\"updatedKeys\":[{\"$ref\":\"$[5].keys[0]\"}],\"withoutSchema\":false},{\"columns\":[{\"columnName\":\"empno\",\"columnType\":-5,\"columnValue\":\"10\",\"index\":1,\"key\":false,\"null\":false,\"update\":true},{\"columnName\":\"ename\",\"columnType\":12,\"columnValue\":\"michale\",\"index\":2,\"key\":false,\"null\":false,\"update\":true},{\"columnName\":\"job\",\"columnType\":12,\"columnValue\":\"salesman\",\"index\":3,\"key\":false,\"null\":false,\"update\":true},{\"columnName\":\"mgr\",\"columnType\":-5,\"columnValue\":\"0\",\"index\":4,\"key\":false,\"null\":false,\"update\":true},{\"columnName\":\"hiredate\",\"columnType\":91,\"columnValue\":\"2018-06-09\",\"index\":5,\"key\":false,\"null\":false,\"update\":true},{\"columnName\":\"sal\",\"columnType\":3,\"columnValue\":\"2000.0\",\"index\":6,\"key\":false,\"null\":false,\"update\":true},{\"columnName\":\"comm\",\"columnType\":3,\"columnValue\":\"400.0\",\"index\":7,\"key\":false,\"null\":false,\"update\":true},{\"columnName\":\"deptno\",\"columnType\":-5,\"columnValue\":\"9\",\"index\":8,\"key\":false,\"null\":false,\"update\":true}],\"eventType\":\"INSERT\",\"executeTime\":1528522525000,\"keys\":[{\"columnName\":\"id\",\"columnType\":-5,\"columnValue\":\"10\",\"index\":0,\"key\":true,\"null\":false,\"update\":true}],\"oldKeys\":[],\"pairId\":1,\"remedy\":false,\"schemaName\":\"bestsign_test\",\"size\":89,\"tableId\":3,\"tableName\":\"employee\",\"updatedColumns\":[{\"$ref\":\"$[6].columns[0]\"},{\"$ref\":\"$[6].columns[1]\"},{\"$ref\":\"$[6].columns[2]\"},{\"$ref\":\"$[6].columns[3]\"},{\"$ref\":\"$[6].columns[4]\"},{\"$ref\":\"$[6].columns[5]\"},{\"$ref\":\"$[6].columns[6]\"},{\"$ref\":\"$[6].columns[7]\"}],\"updatedKeys\":[{\"$ref\":\"$[6].keys[0]\"}],\"withoutSchema\":false},{\"columns\":[{\"columnName\":\"empno\",\"columnType\":-5,\"columnValue\":\"9\",\"index\":1,\"key\":false,\"null\":false,\"update\":true},{\"columnName\":\"ename\",\"columnType\":12,\"columnValue\":\"michale\",\"index\":2,\"key\":false,\"null\":false,\"update\":true},{\"columnName\":\"job\",\"columnType\":12,\"columnValue\":\"salesman\",\"index\":3,\"key\":false,\"null\":false,\"update\":true},{\"columnName\":\"mgr\",\"columnType\":-5,\"columnValue\":\"0\",\"index\":4,\"key\":false,\"null\":false,\"update\":true},{\"columnName\":\"hiredate\",\"columnType\":91,\"columnValue\":\"2018-06-09\",\"index\":5,\"key\":false,\"null\":false,\"update\":true},{\"columnName\":\"sal\",\"columnType\":3,\"columnValue\":\"2000.0\",\"index\":6,\"key\":false,\"null\":false,\"update\":true},{\"columnName\":\"comm\",\"columnType\":3,\"columnValue\":\"400.0\",\"index\":7,\"key\":false,\"null\":false,\"update\":true},{\"columnName\":\"deptno\",\"columnType\":-5,\"columnValue\":\"7\",\"index\":8,\"key\":false,\"null\":false,\"update\":true}],\"eventType\":\"INSERT\",\"executeTime\":1528522525000,\"keys\":[{\"columnName\":\"id\",\"columnType\":-5,\"columnValue\":\"9\",\"index\":0,\"key\":true,\"null\":false,\"update\":true}],\"oldKeys\":[],\"pairId\":1,\"remedy\":false,\"schemaName\":\"bestsign_test\",\"size\":89,\"tableId\":3,\"tableName\":\"employee\",\"updatedColumns\":[{\"$ref\":\"$[7].columns[0]\"},{\"$ref\":\"$[7].columns[1]\"},{\"$ref\":\"$[7].columns[2]\"},{\"$ref\":\"$[7].columns[3]\"},{\"$ref\":\"$[7].columns[4]\"},{\"$ref\":\"$[7].columns[5]\"},{\"$ref\":\"$[7].columns[6]\"},{\"$ref\":\"$[7].columns[7]\"}],\"updatedKeys\":[{\"$ref\":\"$[7].keys[0]\"}],\"withoutSchema\":false},{\"columns\":[{\"columnName\":\"empno\",\"columnType\":-5,\"columnValue\":\"8\",\"index\":1,\"key\":false,\"null\":false,\"update\":true},{\"columnName\":\"ename\",\"columnType\":12,\"columnValue\":\"michale\",\"index\":2,\"key\":false,\"null\":false,\"update\":true},{\"columnName\":\"job\",\"columnType\":12,\"columnValue\":\"salesman\",\"index\":3,\"key\":false,\"null\":false,\"update\":true},{\"columnName\":\"mgr\",\"columnType\":-5,\"columnValue\":\"0\",\"index\":4,\"key\":false,\"null\":false,\"update\":true},{\"columnName\":\"hiredate\",\"columnType\":91,\"columnValue\":\"2018-06-09\",\"index\":5,\"key\":false,\"null\":false,\"update\":true},{\"columnName\":\"sal\",\"columnType\":3,\"columnValue\":\"2000.0\",\"index\":6,\"key\":false,\"null\":false,\"update\":true},{\"columnName\":\"comm\",\"columnType\":3,\"columnValue\":\"400.0\",\"index\":7,\"key\":false,\"null\":false,\"update\":true},{\"columnName\":\"deptno\",\"columnType\":-5,\"columnValue\":\"2\",\"index\":8,\"key\":false,\"null\":false,\"update\":true}],\"eventType\":\"INSERT\",\"executeTime\":1528522525000,\"keys\":[{\"columnName\":\"id\",\"columnType\":-5,\"columnValue\":\"8\",\"index\":0,\"key\":true,\"null\":false,\"update\":true}],\"oldKeys\":[],\"pairId\":1,\"remedy\":false,\"schemaName\":\"bestsign_test\",\"size\":89,\"tableId\":3,\"tableName\":\"employee\",\"updatedColumns\":[{\"$ref\":\"$[8].columns[0]\"},{\"$ref\":\"$[8].columns[1]\"},{\"$ref\":\"$[8].columns[2]\"},{\"$ref\":\"$[8].columns[3]\"},{\"$ref\":\"$[8].columns[4]\"},{\"$ref\":\"$[8].columns[5]\"},{\"$ref\":\"$[8].columns[6]\"},{\"$ref\":\"$[8].columns[7]\"}],\"updatedKeys\":[{\"$ref\":\"$[8].keys[0]\"}],\"withoutSchema\":false},{\"columns\":[{\"columnName\":\"mgr\",\"columnType\":-5,\"columnValue\":\"1\",\"index\":4,\"key\":false,\"null\":false,\"update\":true}],\"eventType\":\"UPDATE\",\"executeTime\":1528522525000,\"keys\":[{\"columnName\":\"id\",\"columnType\":-5,\"columnValue\":\"6\",\"index\":0,\"key\":true,\"null\":false,\"update\":false}],\"oldKeys\":[],\"pairId\":1,\"remedy\":false,\"schemaName\":\"bestsign_test\",\"size\":144,\"tableId\":3,\"tableName\":\"employee\",\"updatedColumns\":[{\"$ref\":\"$[9].columns[0]\"}],\"updatedKeys\":[],\"withoutSchema\":false},{\"columns\":[{\"columnName\":\"mgr\",\"columnType\":-5,\"columnValue\":\"2\",\"index\":4,\"key\":false,\"null\":false,\"update\":true}],\"eventType\":\"UPDATE\",\"executeTime\":1528522525000,\"keys\":[{\"columnName\":\"id\",\"columnType\":-5,\"columnValue\":\"6\",\"index\":0,\"key\":true,\"null\":false,\"update\":false}],\"oldKeys\":[],\"pairId\":1,\"remedy\":false,\"schemaName\":\"bestsign_test\",\"size\":144,\"tableId\":3,\"tableName\":\"employee\",\"updatedColumns\":[{\"$ref\":\"$[10].columns[0]\"}],\"updatedKeys\":[],\"withoutSchema\":false},{\"columns\":[{\"columnName\":\"mgr\",\"columnType\":-5,\"columnValue\":\"1\",\"index\":4,\"key\":false,\"null\":false,\"update\":true}],\"eventType\":\"UPDATE\",\"executeTime\":1528522525000,\"keys\":[{\"columnName\":\"id\",\"columnType\":-5,\"columnValue\":\"7\",\"index\":0,\"key\":true,\"null\":false,\"update\":false}],\"oldKeys\":[],\"pairId\":1,\"remedy\":false,\"schemaName\":\"bestsign_test\",\"size\":144,\"tableId\":3,\"tableName\":\"employee\",\"updatedColumns\":[{\"$ref\":\"$[11].columns[0]\"}],\"updatedKeys\":[],\"withoutSchema\":false},{\"columns\":[{\"columnName\":\"mgr\",\"columnType\":-5,\"columnValue\":\"2\",\"index\":4,\"key\":false,\"null\":false,\"update\":true}],\"eventType\":\"UPDATE\",\"executeTime\":1528522525000,\"keys\":[{\"columnName\":\"id\",\"columnType\":-5,\"columnValue\":\"7\",\"index\":0,\"key\":true,\"null\":false,\"update\":false}],\"oldKeys\":[],\"pairId\":1,\"remedy\":false,\"schemaName\":\"bestsign_test\",\"size\":144,\"tableId\":3,\"tableName\":\"employee\",\"updatedColumns\":[{\"$ref\":\"$[12].columns[0]\"}],\"updatedKeys\":[],\"withoutSchema\":false},{\"columns\":[{\"columnName\":\"mgr\",\"columnType\":-5,\"columnValue\":\"1\",\"index\":4,\"key\":false,\"null\":false,\"update\":true}],\"eventType\":\"UPDATE\",\"executeTime\":1528522525000,\"keys\":[{\"columnName\":\"id\",\"columnType\":-5,\"columnValue\":\"10\",\"index\":0,\"key\":true,\"null\":false,\"update\":false}],\"oldKeys\":[],\"pairId\":1,\"remedy\":false,\"schemaName\":\"bestsign_test\",\"size\":144,\"tableId\":3,\"tableName\":\"employee\",\"updatedColumns\":[{\"$ref\":\"$[13].columns[0]\"}],\"updatedKeys\":[],\"withoutSchema\":false},{\"columns\":[{\"columnName\":\"mgr\",\"columnType\":-5,\"columnValue\":\"2\",\"index\":4,\"key\":false,\"null\":false,\"update\":true}],\"eventType\":\"UPDATE\",\"executeTime\":1528522525000,\"keys\":[{\"columnName\":\"id\",\"columnType\":-5,\"columnValue\":\"10\",\"index\":0,\"key\":true,\"null\":false,\"update\":false}],\"oldKeys\":[],\"pairId\":1,\"remedy\":false,\"schemaName\":\"bestsign_test\",\"size\":144,\"tableId\":3,\"tableName\":\"employee\",\"updatedColumns\":[{\"$ref\":\"$[14].columns[0]\"}],\"updatedKeys\":[],\"withoutSchema\":false}]";
        List<EventData> items = JSON.parseArray(itemsJson,EventData.class);
        List<EventData> mergeItems = DbLoadMerger.merge(items);
        System.out.println(mergeItems);
    }
}
